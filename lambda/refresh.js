!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";n.d(t,"d",function(){return a}),n.d(t,"e",function(){return f}),n.d(t,"b",function(){return h}),n.d(t,"a",function(){return y}),n.d(t,"c",function(){return g});const r=n(1),o=n(2),{URL:s}=n(3),c=n(4);n(5).config();const i=process.env.SPOTIFY_CLIENT_ID,u=process.env.SPOTIFY_CLIENT_SECRET,a=process.env.SPOTIFY_CLIENT_CALLBACK,p=`Basic ${Buffer.from(i+":"+u).toString("base64")}`,f="https://accounts.spotify.com/api/token",l=process.env.ENCRYPTION_SECRET,d=process.env.ENCRYPTION_METHOD||"aes-256-ctr",h=e=>{const t=o.createCipher(d,l);let n=t.update(e,"utf8","hex");return n+=t.final("hex")},y=e=>{const t=o.createDecipher(d,l);let n=t.update(e,"hex","utf8");return n+=t.final("utf8")};function g(e,t={}){return new Promise((n,o)=>{const i={protocol:(e=new s(e)).protocol,hostname:e.hostname,port:e.port,path:e.pathname,method:"POST",headers:{Authorization:p,"Content-Type":"application/x-www-form-urlencoded"}},u=r.request(i,e=>{let t=[];e.on("data",e=>{t.push(e)}),e.on("end",()=>{let r=null;try{r=(r=Buffer.concat(t)).toString();var s=e.headers["content-type"];"string"==typeof s&&(s=s.split(";")[0].trim()),"application/x-www-form-urlencoded"==s?r=c.parse(r):"application/json"==s&&(r=JSON.parse(r))}catch(t){return t.response=e,t.data=r,void o(t)}n({response:e,result:r})})});u.on("error",e=>{o(e)}),t=c.stringify(t),u.write(t),u.end()})}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("url")},function(e,t){e.exports=require("querystring")},function(e,t,n){const r=n(6),o=n(7);function s(e){console.log(`[dotenv][DEBUG] ${e}`)}const c="\n",i=/^\s*([\w.-]+)\s*=\s*(.*)?\s*$/,u=/\\n/g;function a(e,t){const n=Boolean(t&&t.debug),r={};return e.toString().split(c).forEach(function(e,t){const o=e.match(i);if(null!=o){const e=o[1];let t=o[2]||"";const n=t.length-1,s='"'===t[0]&&'"'===t[n];"'"===t[0]&&"'"===t[n]||s?(t=t.substring(1,n),s&&(t=t.replace(u,c))):t=t.trim(),r[e]=t}else n&&s(`did not match key and value when parsing line ${t+1}: ${e}`)}),r}e.exports.config=function(e){let t=o.resolve(process.cwd(),".env"),n="utf8",c=!1;e&&(null!=e.path&&(t=e.path),null!=e.encoding&&(n=e.encoding),null!=e.debug&&(c=!0));try{const e=a(r.readFileSync(t,{encoding:n}),{debug:c});return Object.keys(e).forEach(function(t){process.env.hasOwnProperty(t)?c&&s(`"${t}" is already defined in \`process.env\` and will not be overwritten`):process.env[t]=e[t]}),{parsed:e}}catch(e){return{error:e}}},e.exports.parse=a},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";n.r(t);var r=n(0);exports.handler=(async(e,t)=>{try{const t=JSON.parse('{"'+decodeURI(e.body).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');if(!t.refresh_token)return{statusCode:400,headers:{"Content-Type":"application/json"},body:JSON.stringify({error:"Refresh token is missing from body"})};const n={grant_type:"refresh_token",refresh_token:Object(r.a)(t.refresh_token)},{response:o,result:s}=await Object(r.c)(r.e,n);return s.refresh_token&&(s.refresh_token=Object(r.b)(s.refresh_token)),{statusCode:o.statusCode,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}}catch(e){return e.response?{statusCode:e.response.statusCode,body:""}:{statusCode:500,body:""}}})}]));